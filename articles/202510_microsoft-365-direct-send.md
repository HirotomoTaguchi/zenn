---
title: "Micorosoft 365 DirectSendã«é–¢ã™ã‚‹ãƒ¡ãƒ¢(TBA)"
emoji: "ğŸ›¡" 
type: "tech" ## tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢è¨˜äº‹
topics: [Security] 
published: true
---

Microsoft 365 ã®å„ãƒ†ãƒŠãƒ³ãƒˆã§ã¯ã€DirectSend ã¨ã„ã†æ©Ÿèƒ½ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ãŒã€æ”»æ’ƒè€…ã«ã‚ˆã‚‹æ‚ªç”¨ã‚‚ç¢ºèªã•ã‚Œã¦ãŠã‚Šã€ãƒ¡ãƒ‡ã‚£ã‚¢ç­‰ã§ã‚‚å¯¾ç­–ã®å¿…è¦æ€§ãŒè¨´ãˆã‚‰ã‚Œã¦ã„ã¾ã™ ^[[Microsoft 365 'Direct Send' abused to send phishing as internal users](https://www.bleepingcomputer.com/news/security/microsoft-365-direct-send-abused-to-send-phishing-as-internal-users/)] ã€‚ã¾ã èª¿æŸ»ä¸­ã®å†…å®¹ã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ãŒã€ãƒ¡ãƒ¢ã‚’æ®‹ã—ã¦ã„ã¾ã™ã€‚

## DirectSendã¨ã¯ï¼Ÿ

DirectSend ã¯ã€ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ã®ãƒ‡ãƒã‚¤ã‚¹ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ã¾ãŸã¯ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰ã€Exchange Online ä¸Šã®ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã¸ï¼ˆèªè¨¼ãªã—ã§ï¼‰ç›´æ¥ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã™ã‚‹ãŸã‚ã®æ–¹æ³•ã§ã™ã€‚

### DirectSendã¯ãªãœãƒªã‚¹ã‚¯ãŒã‚ã‚‹ã®ã‹ï¼Ÿ

ã“ã®æ–¹æ³•ã¯ã€é€ä¿¡è€…ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒè‡ªçµ„ç¹”ã®ã‚‚ã®ã§ã‚ã‚‹ç‚¹ã‚’é™¤ã‘ã°ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ã®åŒ¿åã®å—ä¿¡ãƒ¡ãƒ¼ãƒ«ã¨ä¼¼ãŸå‹•ä½œã¨ãªã‚Šã€**èªè¨¼ã‚’å¿…è¦ã¨ã—ã¾ã›ã‚“**ã€‚åŠ ãˆã¦ã€DirectSendã§ã¯ã€SPF/DKIM/DMARCãŒå¤±æ•—ã™ã‚‹ã«ã‚‚é–¢ã‚ã‚‰ãšã€é€šä¿¡ã‚’å†…éƒ¨é€šä¿¡ã¨ã—ã¦å–ã‚Šæ‰±ã†ç«¹ã€ä»–ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒ«ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å±Šã„ã¦ã—ã¾ã†å¯èƒ½æ€§ãŒæŒ‡æ‘˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ã•ã‚‰ã«ã€å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ã‚’å¾Œè¿°ã—ã¦ã„ã¾ã™ãŒã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨SmtpServerã•ãˆã‚ã‹ã‚Œã°å®Ÿè¡Œã§ãã‚‹ã®ã§ã€æ”»æ’ƒè€…ãŒå®Ÿè¡Œã™ã‚‹é›£æ˜“åº¦ã‚‚ä½ã„ã¨ã„ã†ç‰¹å¾´ãŒã‚ã‚Šã¾ã™ã€‚

:::message
å®Ÿéš›ã«ãƒã‚¤ãƒ‘ã‚¹ã•ã‚Œã¦ã—ã¾ã†ã‹ã«ã¤ã„ã¦ã¯ã€ç’°å¢ƒã‚„ãƒ¡ãƒ¼ãƒ«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è£½å“ãƒ»è¨­å®šã«ã‚ˆã‚‹ã®ã§ã”è‡ªèº«ã§ã”ç¢ºèªãã ã•ã„ã€‚
:::

### DirectSendã¯ã©ã®ã‚ˆã†ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§å¿…è¦ãªã®ã‹ï¼Ÿ

å€‹äººçš„ã«ã¯ã‚ã¾ã‚Šä½¿ã£ã¦ã»ã—ããªã„æ©Ÿèƒ½ã§ã™ãŒã€ãƒ—ãƒªãƒ³ã‚¿ãƒ¼ã‹ã‚‰ã®ãƒ¡ãƒ¼ãƒ«ã‚„ä¼šè­°å®¤ã®äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ã®ãƒ¡ãƒ¼ãƒ«ãªã©ã§ä½¿ã‚ã‚Œã¦ã„ãŸã‚Šã—ã¾ã™ã€‚

### å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

PowerShell ã§ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã€DirectSend ã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚`To`, `From`, `SmtpServer` ã¯ã”è‡ªèº«ã®ç’°å¢ƒã«åˆã‚ã›ã¦å¤‰æ›´ã—ã¦åˆ©ç”¨ã—ã¾ã™ã€‚å°šã€25ç•ªãƒãƒ¼ãƒˆã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚µãƒ¼ãƒ“ã‚¹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚„Azureãªã©ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¯ãƒ©ã‚¦ãƒ‰ã«ãŠã„ã¦ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‚‹ã®ã§ã€ã”è‡ªå®…ã§è©¦ãã†ã¨æ€ã£ãŸã‚ãªãŸã¯ã‹ãªã‚Šå³ã—ã„ã§ã™ã€‚

```powershell
$EmailMessage = @{
    To         = "XXX@yourdomain.com"
    From       = "YYY@yourdomain.com"
    Subject    = "DirectSend test"
    Body       = "DirectSend test"
    SmtpServer = "yourdomain-com.mail.protection.outlook.com" # MXãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª
    Port       = "25"
    UseSSL     = $true
}
Send-MailMessage @EmailMessage
```

:::message alert
ä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ä»–çµ„ç¹”ã«å¯¾ã—ã¦å®Ÿæ–½ã™ã‚‹ã“ã¨ã¯ã‚µã‚¤ãƒãƒ¼æ”»æ’ƒã¨åŒç­‰ã®è¡Œç‚ºã¨ãªã‚Šã¾ã™ã®ã§ã€ãƒ†ã‚¹ãƒˆã™ã‚‹éš›ã«ã¯å¿…ãšè¨±å¯ã•ã‚ŒãŸç’°å¢ƒã«å¯¾ã—ã¦å®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚
:::

## DirectSendã®ç®¡ç†è€…ãŒå´ã®è¨­å®š

### å‰ææ¡ä»¶

ã¾ãšã€Exchange Online PowerShell ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€æ¥ç¶šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

1.  **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« (æœªå®Ÿæ–½ã®å ´åˆ):**

```powershell
Install-Module -Name ExchangeOnlineManagement -Force
```

2.  **Exchange Online ã¸ã®æ¥ç¶š:**

```powershell
Connect-ExchangeOnline
```

### çŠ¶æ…‹ã®ç¢ºèª

ç¾åœ¨ã®è¨­å®šçŠ¶æ…‹ã‚’ç¢ºèªã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```powershell
Get-OrganizationConfig | Select-Object Identity, RejectDirectSend
```

**å®Ÿè¡Œçµæœã®ä¾‹ (ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹å ´åˆ):**
`RejectDirectSend` ãŒ `True` ã«ãªã£ã¦ã„ã‚Œã°ã€DirectSend ã¯ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™ã€‚

### ç„¡åŠ¹åŒ–ã‚³ãƒãƒ³ãƒ‰

æ¥ç¶šå¾Œã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ DirectSend ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¾ã™ã€‚

```powershell
Set-OrganizationConfig -RejectDirectSend $true
````

### ï¼ˆå‚è€ƒï¼‰DirectSendã®æœ‰åŠ¹åŒ– (è¨±å¯)

é€†ã« DirectSend ã‚’è¨±å¯ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®çŠ¶æ…‹ã«æˆ»ã™ï¼‰å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```powershell
Set-OrganizationConfig -RejectDirectSend $false
```

## DirectSendã‚’åˆ©ç”¨ã›ã–ã‚‹ã‚’å¾—ãªã„å ´åˆã®å¯¾å¿œ

### DirectSend ã®åˆ©ç”¨ã®å®Ÿæ…‹èª¿æŸ»

DirectSendã‚’ç„¡åŠ¹ã«ã™ã‚‹å‰ã«ã€ã©ã‚Œã ã‘ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‹è¦‹ãŸã„ã¨ã„ã†ã‚±ãƒ¼ã‚¹ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚ã©ã®ã‚ˆã†ã«è¦‹ã‚Œã°ä¸€ç•ªã‚¹ãƒ ãƒ¼ã‚ºã«è¦‹ã‚Œã°ã„ã„ã®ã‹è‹¦å¿ƒã—ã¦ãŠã‚Šã€ãƒãƒƒãƒˆã«è»¢ãŒã£ã¦ã„ã‚‹ã‚¯ã‚¨ãƒªãªã©ã‚’ä½¿ã£ã¦ã‚‚ä¸Šæ‰‹ãæ‹¾ã£ã¦ãã‚Œãªã„ã‚±ãƒ¼ã‚¹ãŒå¤šã„ã®ã§ã™ãŒã€å°‘ãªãã¨ã‚‚Advanced Huntingã«ãŠã„ã¦ã€M365ã®å†…éƒ¨ã‹ã‚‰å†…éƒ¨ã¸ã®ãƒ¡ãƒ¼ãƒ«ã¯ `{"DKIM":"none","DMARC":"none"}` ã¨ãªã‚‹ã®ã«å¯¾ã—ã¦ã€DirectSendã¯å†…éƒ¨ã‹ã‚‰å†…éƒ¨ã§ã‚‚ `{"SPF":"fail","DKIM":"none","DMARC":"none","CompAuth":"fail"}` ã¨ãªã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚

![](https://github.com/user-attachments/assets/fc61393f-2c0c-4ae1-856d-f8312d477387)

ä»–ã®ã‚‚å«ã¾ã‚Œã¦ã—ã¾ã†ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ãªAdvanced Huntingã§ç›®ä»˜ã¯ã§ãã‚‹ã‹ã¨æ€ã„ã¾ã—ãŸã€‚

```
EmailEvents 
| where Timestamp > ago(30d) 
| where SenderFromDomain contains "yourdomain.com"
| where RecipientDomain contains "yourdomain.com"
| extend AuthDetails = todynamic(AuthenticationDetails)
| where AuthDetails.SPF == "fail" 
    and AuthDetails.DKIM == "none" 
    and AuthDetails.DMARC == "none" 
    and AuthDetails.CompAuth == "fail"
```

### DirectSend ã‚’é™å®šçš„ã«è¨±å¯ã™ã‚‹

TBAï¼ˆèª¿æŸ»ä¸­ï¼‰

https://techcommunity.microsoft.com/blog/exchange/direct-send-vs-sending-directly-to-an-exchange-online-tenant/4439865

## ã¾ã¨ã‚

TBAï¼ˆèª¿æŸ»ä¸­ï¼‰
